"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AsyncGroup = exports.SaveCookies = exports.ParseCookie = exports.List = exports.Guid = exports.nameof = exports.KeyValuePair = void 0;
var Cst = require("./ConstValue");
var KeyValuePair = (function () {
    function KeyValuePair(_key, _value) {
        this.Key = _key;
        this.Value = _value;
    }
    return KeyValuePair;
}());
exports.KeyValuePair = KeyValuePair;
var nameof = function (name) { return name; };
exports.nameof = nameof;
var Guid = (function () {
    function Guid(value) {
        this.value = this.empty;
        if (value) {
            if (Guid.isValid(value)) {
                this.value = value;
            }
        }
    }
    Guid.newGuid = function () {
        return new Guid('xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0;
            var v = (c == 'x') ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        }));
    };
    Object.defineProperty(Guid, "empty", {
        get: function () {
            return '00000000-0000-0000-0000-000000000000';
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Guid.prototype, "empty", {
        get: function () {
            return Guid.empty;
        },
        enumerable: false,
        configurable: true
    });
    Guid.isValid = function (str) {
        var validRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
        return validRegex.test(str);
    };
    Guid.prototype.toString = function () {
        return this.value;
    };
    Guid.prototype.toJSON = function () {
        return this.value;
    };
    return Guid;
}());
exports.Guid = Guid;
var List = (function () {
    function List() {
    }
    List.Insert = function (src, item, index) {
        src.splice(index, 0, item);
        return src;
    };
    List.Remove = function (src, index) {
        src.splice(index, 1);
        return src;
    };
    List.Add = function (src, item) {
        src.push(item);
        return src;
    };
    return List;
}());
exports.List = List;
function ParseCookie(cookieStr) {
    var cookieStrArr = cookieStr.split('=');
    var key = cookieStrArr[0];
    var value = cookieStrArr[1].split(';')[0];
    return new KeyValuePair(key, value);
}
exports.ParseCookie = ParseCookie;
function SaveCookies(NewCookies) {
    if (NewCookies.length > 0) {
        var cookiesMap = {};
        if (wx.getStorageSync(Cst.StorageKey.Cookies)) {
            cookiesMap = JSON.parse(wx.getStorageSync(Cst.StorageKey.Cookies));
        }
        for (var i = 0; i < NewCookies.length; i++) {
            var cookie = ParseCookie(NewCookies[i]);
            cookiesMap[cookie.Key] = cookie.Value;
        }
        wx.setStorageSync(Cst.StorageKey.Cookies, JSON.stringify(cookiesMap));
    }
}
exports.SaveCookies = SaveCookies;
var AsyncGroup = (function () {
    function AsyncGroup(_asyncFuncMap) {
        this.ResultMap = new Map();
        this.lock = false;
        this.AsyncFuncMap = _asyncFuncMap;
        this.CompletedCnt = this.AsyncFuncMap.size;
    }
    AsyncGroup.prototype.Run = function () {
        var _this = this;
        this.AsyncFuncMap.forEach(function (func, key) {
            func(function (result) {
                _this.ResultMap.set(key, result);
                _this.CheckComplete();
            });
        });
        return this;
    };
    AsyncGroup.prototype.ContinueWith = function (callback) {
        this.Complete = callback;
        return this;
    };
    AsyncGroup.prototype.CheckComplete = function () {
        while (this.lock) { }
        this.lock = true;
        this.CompletedCnt--;
        if (this.CompletedCnt == 0) {
            this.Complete(this.ResultMap);
        }
        this.lock = false;
    };
    return AsyncGroup;
}());
exports.AsyncGroup = AsyncGroup;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxrQ0FBcUM7QUFDckM7SUFHSSxzQkFBWSxJQUFTLEVBQUUsTUFBVztRQUM5QixJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztRQUNoQixJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztJQUN4QixDQUFDO0lBQ0wsbUJBQUM7QUFBRCxDQUFDLEFBUEQsSUFPQztBQVBZLG9DQUFZO0FBU2xCLElBQU0sTUFBTSxHQUFHLFVBQUksSUFBYSxJQUFLLE9BQUEsSUFBSSxFQUFKLENBQUksQ0FBQztBQUFwQyxRQUFBLE1BQU0sVUFBOEI7QUFFakQ7SUFtQkMsY0FBWSxLQUFjO1FBRGxCLFVBQUssR0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBRWxDLElBQUksS0FBSyxFQUFFO1lBQ1YsSUFBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQzthQUNuQjtTQUNEO0lBQ0YsQ0FBQztJQXhCYSxZQUFPLEdBQXJCO1FBQ0MsT0FBTyxJQUFJLElBQUksQ0FBQyxzQ0FBc0MsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLFVBQUEsQ0FBQztZQUN4RSxJQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNqQyxJQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFDM0MsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0Qsc0JBQWtCLGFBQUs7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QnZCLElBQUksQ0FBQyxZQUFZLEdBQUcsYUFBYSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUM7SUFDL0MsQ0FBQztJQUVNLHdCQUFHLEdBQVY7UUFBQSxpQkFRQztRQVBHLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBSSxFQUFFLEdBQUc7WUFDaEMsSUFBSSxDQUFDLFVBQUMsTUFBTTtnQkFDUixLQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ2hDLEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUN6QixDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFBO1FBQ0YsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVNLGlDQUFZLEdBQW5CLFVBQW9CLFFBQTRDO1FBQzVELElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFHTyxrQ0FBYSxHQUFyQjtRQUNJLE9BQU0sSUFBSSxDQUFDLElBQUksRUFBQyxHQUFFO1FBQ2xCLElBQUksQ0FBQyxJQUFJLEdBQUMsSUFBSSxDQUFDO1FBQ2YsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3BCLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxDQUFDLEVBQUU7WUFDeEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7U0FDaEM7UUFDRCxJQUFJLENBQUMsSUFBSSxHQUFDLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBQ0wsaUJBQUM7QUFBRCxDQUFDLEFBdENELElBc0NDO0FBdENZLGdDQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENzdCA9IHJlcXVpcmUoXCIuL0NvbnN0VmFsdWVcIik7XHJcbmV4cG9ydCBjbGFzcyBLZXlWYWx1ZVBhaXI8VF9LLCBUX1Y+e1xyXG4gICAgcHVibGljIEtleTogVF9LO1xyXG4gICAgcHVibGljIFZhbHVlOiBUX1Y7XHJcbiAgICBjb25zdHJ1Y3Rvcihfa2V5OiBUX0ssIF92YWx1ZTogVF9WKSB7XHJcbiAgICAgICAgdGhpcy5LZXkgPSBfa2V5O1xyXG4gICAgICAgIHRoaXMuVmFsdWUgPSBfdmFsdWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBuYW1lb2YgPSA8VD4obmFtZToga2V5b2YgVCkgPT4gbmFtZTtcclxuXHJcbmV4cG9ydCBjbGFzcyBHdWlkIHtcclxuXHRwdWJsaWMgc3RhdGljIG5ld0d1aWQoKTogR3VpZCB7XHJcblx0XHRyZXR1cm4gbmV3IEd1aWQoJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBjID0+IHtcclxuXHRcdFx0Y29uc3QgciA9IE1hdGgucmFuZG9tKCkgKiAxNiB8IDA7XHJcblx0XHRcdGNvbnN0IHYgPSAoYyA9PSAneCcpID8gciA6IChyICYgMHgzIHwgMHg4KTtcclxuXHRcdFx0cmV0dXJuIHYudG9TdHJpbmcoMTYpO1xyXG5cdFx0fSkpO1xyXG5cdH1cclxuXHRwdWJsaWMgc3RhdGljIGdldCBlbXB0eSgpOiBzdHJpbmcge1xyXG5cdFx0cmV0dXJuICcwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAnO1xyXG5cdH1cclxuXHRwdWJsaWMgZ2V0IGVtcHR5KCk6IHN0cmluZyB7XHJcblx0XHRyZXR1cm4gR3VpZC5lbXB0eTtcclxuXHR9XHJcblx0cHVibGljIHN0YXRpYyBpc1ZhbGlkKHN0cjogc3RyaW5nKTogYm9vbGVhbiB7XHJcblx0XHRjb25zdCB2YWxpZFJlZ2V4ID0gL15bMC05YS1mXXs4fS1bMC05YS1mXXs0fS1bMS01XVswLTlhLWZdezN9LVs4OWFiXVswLTlhLWZdezN9LVswLTlhLWZdezEyfSQvaTtcclxuXHRcdHJldHVybiB2YWxpZFJlZ2V4LnRlc3Qoc3RyKTtcclxuXHR9XHJcblx0cHJpdmF0ZSB2YWx1ZTogc3RyaW5nID0gdGhpcy5lbXB0eTtcclxuXHRjb25zdHJ1Y3Rvcih2YWx1ZT86IHN0cmluZykge1xyXG5cdFx0aWYgKHZhbHVlKSB7XHJcblx0XHRcdGlmKEd1aWQuaXNWYWxpZCh2YWx1ZSkpIHtcclxuXHRcdFx0XHR0aGlzLnZhbHVlID0gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0cHVibGljIHRvU3RyaW5nKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMudmFsdWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdG9KU09OKCk6IHN0cmluZyB7XHJcblx0XHRyZXR1cm4gdGhpcy52YWx1ZTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBMaXN0e1xyXG4gICAgcHVibGljIHN0YXRpYyBJbnNlcnQ8VD4oc3JjOkFycmF5PFQ+LGl0ZW06VCxpbmRleDpudW1iZXIpIHtcclxuICAgICAgICBzcmMuc3BsaWNlKGluZGV4LCAwLCBpdGVtKTtcclxuICAgICAgICByZXR1cm4gc3JjO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBSZW1vdmU8VD4oc3JjOiBBcnJheTxUPixpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgc3JjLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgcmV0dXJuIHNyYztcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgQWRkPFQ+KHNyYzogQXJyYXk8VD4saXRlbTogVCkge1xyXG4gICAgICAgIHNyYy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgIHJldHVybiBzcmM7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBQYXJzZUNvb2tpZShjb29raWVTdHI6IHN0cmluZyk6IEtleVZhbHVlUGFpcjxzdHJpbmcsIHN0cmluZz4ge1xyXG4gICAgbGV0IGNvb2tpZVN0ckFycjogc3RyaW5nW10gPSBjb29raWVTdHIuc3BsaXQoJz0nKTtcclxuICAgIGxldCBrZXk6IHN0cmluZyA9IGNvb2tpZVN0ckFyclswXTtcclxuICAgIGxldCB2YWx1ZTogc3RyaW5nID0gY29va2llU3RyQXJyWzFdLnNwbGl0KCc7JylbMF07XHJcbiAgICByZXR1cm4gbmV3IEtleVZhbHVlUGFpcjxzdHJpbmcsIHN0cmluZz4oa2V5LCB2YWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBTYXZlQ29va2llcyhOZXdDb29raWVzOiBzdHJpbmdbXSkge1xyXG4gICAgaWYgKE5ld0Nvb2tpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGxldCBjb29raWVzTWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XHJcbiAgICAgICAgaWYgKHd4LmdldFN0b3JhZ2VTeW5jKENzdC5TdG9yYWdlS2V5LkNvb2tpZXMpKSB7XHJcbiAgICAgICAgICAgIGNvb2tpZXNNYXAgPSBKU09OLnBhcnNlKHd4LmdldFN0b3JhZ2VTeW5jKENzdC5TdG9yYWdlS2V5LkNvb2tpZXMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOZXdDb29raWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBjb29raWU6IEtleVZhbHVlUGFpcjxzdHJpbmcsIHN0cmluZz4gPSBQYXJzZUNvb2tpZShOZXdDb29raWVzW2ldKTtcclxuICAgICAgICAgICAgY29va2llc01hcFtjb29raWUuS2V5XSA9IGNvb2tpZS5WYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoQ3N0LlN0b3JhZ2VLZXkuQ29va2llcywgSlNPTi5zdHJpbmdpZnkoY29va2llc01hcCkpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQXN5bmNHcm91cCB7XHJcbiAgICBwcml2YXRlIEFzeW5jRnVuY01hcDogTWFwPHN0cmluZywgKGNhbGxiYWNrOiAocmVzdWx0OiBhbnkpID0+IHZvaWQpID0+IGFueT5cclxuICAgIHByaXZhdGUgUmVzdWx0TWFwOiBNYXA8c3RyaW5nLCBhbnk+ID1uZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgcHJpdmF0ZSBDb21wbGV0ZWRDbnQ6bnVtYmVyO1xyXG5cclxuICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgcHJpdmF0ZSBDb21wbGV0ZTogKHJlc3VsdDogTWFwPHN0cmluZywgYW55PikgPT4gdm9pZCA7XHJcblxyXG4gICAgY29uc3RydWN0b3IoX2FzeW5jRnVuY01hcDogTWFwPHN0cmluZywgKGNhbGxiYWNrOiAocmVzdWx0OmFueSkgPT4gdm9pZCkgPT4gYW55Pikge1xyXG4gICAgICAgIHRoaXMuQXN5bmNGdW5jTWFwID0gX2FzeW5jRnVuY01hcDtcclxuICAgICAgICB0aGlzLkNvbXBsZXRlZENudCA9IHRoaXMuQXN5bmNGdW5jTWFwLnNpemU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIFJ1bigpOiBBc3luY0dyb3VwIHtcclxuICAgICAgICB0aGlzLkFzeW5jRnVuY01hcC5mb3JFYWNoKChmdW5jLCBrZXkpID0+IHtcclxuICAgICAgICAgICAgZnVuYygocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlJlc3VsdE1hcC5zZXQoa2V5LCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5DaGVja0NvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIENvbnRpbnVlV2l0aChjYWxsYmFjazogKHJlc3VsdDogTWFwPHN0cmluZywgYW55PikgPT4gdm9pZCk6QXN5bmNHcm91cCB7XHJcbiAgICAgICAgdGhpcy5Db21wbGV0ZSA9IGNhbGxiYWNrO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9jazpib29sZWFuPWZhbHNlO1xyXG4gICAgcHJpdmF0ZSBDaGVja0NvbXBsZXRlKCkge1xyXG4gICAgICAgIHdoaWxlKHRoaXMubG9jayl7fVxyXG4gICAgICAgIHRoaXMubG9jaz10cnVlO1xyXG4gICAgICAgIHRoaXMuQ29tcGxldGVkQ250LS07XHJcbiAgICAgICAgaWYgKHRoaXMuQ29tcGxldGVkQ250ID09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5Db21wbGV0ZSh0aGlzLlJlc3VsdE1hcClcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2NrPWZhbHNlO1xyXG4gICAgfVxyXG59Il19